/*!
 * jQuery Smart Banner
 * Copyright (c) 2012 Arnold Daniels <arnold@jasny.net>
 * Based on 'jQuery Smart Web App Banner' by Kurt Zenisek @ kzeni.com
 */
(function(e){var t=function(t){this.origHtmlMargin=parseFloat(e("html").css("margin-top"));this.options=e.extend({},e.smartbanner.defaults,t);var n=navigator.standalone,r=navigator.userAgent;if(this.options.force){this.type=this.options.force}else if(r.match(/iPad|iPhone|iPod/i)!=null){if(r.match(/Safari/i)!=null&&(r.match(/CriOS/i)!=null||window.Number(navigator.userAgent.substr(navigator.userAgent.indexOf("OS ")+3,3).replace("_","."))<6))this.type="ios"}else if(r.match(/Android/i)!=null){this.type="android"}else if(r.match(/Windows NT 6.2/i)!=null&&r.match(/Touch/i)!==null){this.type="windows"}if(!this.type||n||this.getCookie("sb-closed")||this.getCookie("sb-installed")){return}this.scale=this.options.scale=="auto"?e(window).width()/window.screen.width:this.options.scale;if(this.scale<1)this.scale=1;var i=e(this.type=="android"?'meta[name="google-play-app"]':this.type=="ios"?'meta[name="apple-itunes-app"]':'meta[name="msApplication-ID"]');if(i.length==0)return;if(this.type=="windows"){this.pfn=e('meta[name="msApplication-PackageFamilyName"]').attr("content");this.appId=i.attr("content")[1]}else{this.appId=/app-id=([^\s,]+)/.exec(i.attr("content"))[1]}this.title=this.options.title?this.options.title:e("title").text().replace(/\s*[|\-Â·].*$/,"");this.author=this.options.author?this.options.author:e('meta[name="author"]').length?e('meta[name="author"]').attr("content"):window.location.hostname;this.create();this.show();this.listen()};t.prototype={constructor:t,create:function(){var t,n=this.options.url?this.options.url:(this.type=="windows"?"ms-windows-store:PDP?PFN="+this.pfn:this.type=="android"?"market://details?id=":"https://itunes.apple.com/"+this.options.appStoreLanguage+"/app/id")+this.appId,r=this.options.price?this.options.price+" - "+(this.type=="android"?this.options.inGooglePlay:this.type=="ios"?this.options.inAppStore:this.options.inWindowsStore):"",i=this.options.iconGloss===null?this.type=="ios":this.options.iconGloss;e("body").append('<div id="smartbanner" class="'+this.type+'"><div class="sb-container"><a href="#" class="sb-close">&times;</a><span class="sb-icon"></span><div class="sb-info"><strong>'+this.title+"</strong><span>"+this.author+"</span><span>"+r+'</span></div><a href="'+n+'" class="sb-button"><span>'+this.options.button+"</span></a></div></div>");if(this.options.icon){t=this.options.icon}else if(e('link[rel="apple-touch-icon-precomposed"]').length>0){t=e('link[rel="apple-touch-icon-precomposed"]').attr("href");if(this.options.iconGloss===null)i=false}else if(e('link[rel="apple-touch-icon"]').length>0){t=e('link[rel="apple-touch-icon"]').attr("href")}else if(e('meta[name="msApplication-TileImage"]').length>0){t=e('meta[name="msApplication-TileImage"]').attr("content")}else if(e('meta[name="msapplication-TileImage"]').length>0){t=e('meta[name="msapplication-TileImage"]').attr("content")}if(t){e("#smartbanner .sb-icon").css("background-image","url("+t+")");if(i)e("#smartbanner .sb-icon").addClass("gloss")}else{e("#smartbanner").addClass("no-icon")}this.bannerHeight=e("#smartbanner").outerHeight()+2;if(this.scale>1){e("#smartbanner").css("top",parseFloat(e("#smartbanner").css("top"))*this.scale).css("height",parseFloat(e("#smartbanner").css("height"))*this.scale);e("#smartbanner .sb-container").css("-webkit-transform","scale("+this.scale+")").css("-msie-transform","scale("+this.scale+")").css("-moz-transform","scale("+this.scale+")").css("width",e(window).width()/this.scale)}},listen:function(){e("#smartbanner .sb-close").on("click",e.proxy(this.close,this));e("#smartbanner .sb-button").on("click",e.proxy(this.install,this))},show:function(t){e("#smartbanner").stop().animate({top:0},this.options.speedIn).addClass("shown");e("html").animate({marginTop:this.origHtmlMargin+this.bannerHeight*this.scale},this.options.speedIn,"swing",t)},hide:function(t){e("#smartbanner").stop().animate({top:-1*this.bannerHeight*this.scale},this.options.speedOut).removeClass("shown");e("html").animate({marginTop:this.origHtmlMargin},this.options.speedOut,"swing",t)},close:function(e){e.preventDefault();this.hide();this.setCookie("sb-closed","true",this.options.daysHidden)},install:function(e){this.hide();this.setCookie("sb-installed","true",this.options.daysReminder)},setCookie:function(e,t,n){var r=new Date;r.setDate(r.getDate()+n);t=escape(t)+(n==null?"":"; expires="+r.toUTCString());document.cookie=e+"="+t+"; path=/;"},getCookie:function(e){var t,n,r,i=document.cookie.split(";");for(t=0;t<i.length;t++){n=i[t].substr(0,i[t].indexOf("="));r=i[t].substr(i[t].indexOf("=")+1);n=n.replace(/^\s+|\s+$/g,"");if(n==e){return unescape(r)}}return null},switchType:function(){var t=this;this.hide(function(){t.type=t.type=="android"?"ios":"android";var n=e(t.type=="android"?'meta[name="google-play-app"]':'meta[name="apple-itunes-app"]').attr("content");t.appId=/app-id=([^\s,]+)/.exec(n)[1];e("#smartbanner").detach();t.create();t.show()})}};e.smartbanner=function(n){var r=e(window),i=r.data("typeahead"),s=typeof n=="object"&&n;if(!i)r.data("typeahead",i=new t(s));if(typeof n=="string")i[n]()};e.smartbanner.defaults={title:null,author:null,price:"FREE",appStoreLanguage:"us",inAppStore:"On the App Store",inGooglePlay:"In Google Play",inWindowsStore:"In the Windows Store",icon:null,iconGloss:null,button:"VIEW",url:null,scale:"auto",speedIn:300,speedOut:400,daysHidden:15,daysReminder:90,force:null};e.smartbanner.Constructor=t})(window.jQuery)
